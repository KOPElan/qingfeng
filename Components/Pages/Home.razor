@page "/"
@using QingFeng.Services
@using QingFeng.Models
@inject ISystemMonitorService SystemMonitorService
@rendermode InteractiveServer

<PageTitle>清风 - 家庭服务器主页</PageTitle>

<MudText Typo="Typo.h3" Class="mb-4">欢迎使用清风家庭服务器</MudText>

<MudPaper Elevation="2" Class="pa-4 mb-4">
    <MudText Typo="Typo.h5" Class="mb-4">系统概览</MudText>
    @if (systemInfo != null)
    {
        <MudGrid>
            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="4">
                    <MudCardContent Class="text-center">
                        <MudIcon Icon="@Icons.Material.Filled.Speed" Size="Size.Large" Color="Color.Primary" Class="mb-2" />
                        <MudText Typo="Typo.h6" Class="mb-1">CPU</MudText>
                        <MudText Typo="Typo.h3" Color="Color.Primary">@systemInfo.Cpu.UsagePercent%</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary">@systemInfo.Cpu.CoreCount 核心</MudText>
                    </MudCardContent>
                </MudCard>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="4">
                    <MudCardContent Class="text-center">
                        <MudIcon Icon="@Icons.Material.Filled.Memory" Size="Size.Large" Color="Color.Secondary" Class="mb-2" />
                        <MudText Typo="Typo.h6" Class="mb-1">内存</MudText>
                        <MudText Typo="Typo.h3" Color="Color.Secondary">@systemInfo.Memory.UsagePercent%</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary">@systemInfo.Memory.UsedGB / @systemInfo.Memory.TotalGB</MudText>
                    </MudCardContent>
                </MudCard>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="4">
                    <MudCardContent Class="text-center">
                        <MudIcon Icon="@Icons.Material.Filled.Storage" Size="Size.Large" Color="Color.Tertiary" Class="mb-2" />
                        <MudText Typo="Typo.h6" Class="mb-1">磁盘</MudText>
                        <MudText Typo="Typo.h3" Color="Color.Tertiary">@diskCount</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary">@diskCount 个磁盘</MudText>
                    </MudCardContent>
                </MudCard>
            </MudItem>
            <MudItem xs="12" sm="6" md="3">
                <MudCard Elevation="4">
                    <MudCardContent Class="text-center">
                        <MudIcon Icon="@Icons.Material.Filled.NetworkCheck" Size="Size.Large" Color="Color.Success" Class="mb-2" />
                        <MudText Typo="Typo.h6" Class="mb-1">网络</MudText>
                        <MudText Typo="Typo.h3" Color="Color.Success">@networkCount</MudText>
                        <MudText Typo="Typo.body2" Color="Color.Secondary">@networkCount 个接口</MudText>
                    </MudCardContent>
                </MudCard>
            </MudItem>
        </MudGrid>
    }
    else
    {
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
        <MudText Class="ml-2">加载中...</MudText>
    }
</MudPaper>

<MudAlert Severity="Severity.Info" Variant="Variant.Filled">
    <MudText Typo="Typo.h6" Class="mb-2">功能介绍</MudText>
    <MudStack Spacing="2">
        <MudStack Row="true" AlignItems="AlignItems.Center">
            <MudIcon Icon="@Icons.Material.Filled.Dashboard" />
            <MudText><strong>系统监控</strong>：实时查看CPU、内存、磁盘、网络等系统资源信息</MudText>
        </MudStack>
        <MudStack Row="true" AlignItems="AlignItems.Center">
            <MudIcon Icon="@Icons.Material.Filled.Storage" />
            <MudText><strong>磁盘管理</strong>：管理磁盘挂载和共享</MudText>
        </MudStack>
        <MudStack Row="true" AlignItems="AlignItems.Center">
            <MudIcon Icon="@Icons.Material.Filled.ContentCopy" />
            <MudText><strong>Docker管理</strong>：管理Docker容器和镜像</MudText>
        </MudStack>
        <MudStack Row="true" AlignItems="AlignItems.Center">
            <MudIcon Icon="@Icons.Material.Filled.Folder" />
            <MudText><strong>文件管理</strong>：浏览和管理文件系统</MudText>
        </MudStack>
    </MudStack>
</MudAlert>

@code {
    private SystemResourceInfo? systemInfo;
    private int diskCount = 0;
    private int networkCount = 0;

    protected override async Task OnInitializedAsync()
    {
        await RefreshData();
    }

    private async Task RefreshData()
    {
        systemInfo = await SystemMonitorService.GetSystemResourceInfoAsync();
        diskCount = systemInfo?.Disks?.Count ?? 0;
        networkCount = systemInfo?.Networks?.Count ?? 0;
    }
}
